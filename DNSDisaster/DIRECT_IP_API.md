# ç›´æ¥IPæŸ¥è¯¢APIåŠŸèƒ½

## ğŸš€ æ–°åŠŸèƒ½ä»‹ç»

ä¸ºäº†æä¾›æ›´å¿«é€Ÿã€ç®€å•çš„IPè·å–æ–¹å¼ï¼Œç³»ç»Ÿæ–°å¢äº†ç›´æ¥IPæŸ¥è¯¢APIåŠŸèƒ½ã€‚å½“é…ç½®äº†ç›´æ¥IPæŸ¥è¯¢APIæ—¶ï¼Œç³»ç»Ÿä¼šä¼˜å…ˆä½¿ç”¨è¿™ä¸ªAPIè·å–IPåœ°å€ï¼Œè€Œä¸æ˜¯é€šè¿‡å¤æ‚çš„è®¾å¤‡ç»„APIæ–¹å¼ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### ä¼˜å…ˆçº§ç­–ç•¥
```
é…ç½®äº†DirectIpApiUrl?
    â”œâ”€ æ˜¯ â†’ ä½¿ç”¨ç›´æ¥IPæŸ¥è¯¢API
    â”‚       â”œâ”€ æˆåŠŸ â†’ è¿”å›IPåœ°å€ âœ…
    â”‚       â””â”€ å¤±è´¥ â†’ å›é€€åˆ°è®¾å¤‡ç»„API ğŸ”„
    â””â”€ å¦ â†’ ä½¿ç”¨è®¾å¤‡ç»„APIï¼ˆåŸæœ‰æ–¹å¼ï¼‰
```

### æ€§èƒ½ä¼˜åŠ¿
| æ–¹å¼ | æ­¥éª¤ | æ—¶é—´ | å¤æ‚åº¦ |
|------|------|------|--------|
| **ç›´æ¥API** | 1æ¬¡HTTPè¯·æ±‚ | ~200ms | ç®€å• |
| **è®¾å¤‡ç»„API** | ç™»å½• + æŸ¥è¯¢ + è§£æ | ~1500ms | å¤æ‚ |

**æ€§èƒ½æå‡**: çº¦7.5å€é€Ÿåº¦æå‡ï¼

## ğŸ“‹ é…ç½®è¯´æ˜

### æ–°å¢é…ç½®é¡¹
```json
{
  "IpProvider": {
    "Username": "your_username",
    "Password": "your_password",
    "DeviceGroupId": 1,
    "ApiBaseUrl": "https://nya.trp.sh/api/v1",
    "DirectIpApiUrl": "https://nya-getip-iepl1.trp.sh/status"
  }
}
```

### é…ç½®é¡¹è¯´æ˜
| é…ç½®é¡¹ | ç±»å‹ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `DirectIpApiUrl` | string | å¦ | null | ç›´æ¥IPæŸ¥è¯¢APIåœ°å€ |

### ä½¿ç”¨åœºæ™¯

#### åœºæ™¯1: ä½¿ç”¨ç›´æ¥APIï¼ˆæ¨èï¼‰
```json
{
  "IpProvider": {
    "DirectIpApiUrl": "https://nya-getip-iepl1.trp.sh/status"
  }
}
```
**ä¼˜åŠ¿**: å¿«é€Ÿã€ç®€å•ã€æ— éœ€è®¤è¯

#### åœºæ™¯2: ä»…ä½¿ç”¨è®¾å¤‡ç»„API
```json
{
  "IpProvider": {
    "Username": "your_username",
    "Password": "your_password",
    "DeviceGroupId": 1,
    "ApiBaseUrl": "https://nya.trp.sh/api/v1"
    // ä¸é…ç½® DirectIpApiUrl
  }
}
```
**ä¼˜åŠ¿**: å…¼å®¹æ€§å¥½ï¼Œæ”¯æŒå¤šè®¾å¤‡ç»„

#### åœºæ™¯3: åŒé‡ä¿éšœï¼ˆæ¨èï¼‰
```json
{
  "IpProvider": {
    "Username": "your_username",
    "Password": "your_password", 
    "DeviceGroupId": 1,
    "ApiBaseUrl": "https://nya.trp.sh/api/v1",
    "DirectIpApiUrl": "https://nya-getip-iepl1.trp.sh/status"
  }
}
```
**ä¼˜åŠ¿**: ä¸»ç”¨ç›´æ¥APIï¼Œå¤‡ç”¨è®¾å¤‡ç»„API

## ğŸ”§ APIè§„èŒƒ

### è¯·æ±‚æ ¼å¼
```http
GET https://nya-getip-iepl1.trp.sh/status
```

### å“åº”æ ¼å¼
```json
{
  "running": true,
  "switching": false,
  "interface": "eth2",
  "config_type": "networking",
  "current_ip": "14.215.39.86",
  "fail_count": 0,
  "fail_threshold": 10,
  "pool": {
    "available": 1,
    "discarded": 1,
    "exhausted": false
  },
  "stats": {
    "total_checks": 84078,
    "failed_checks": 10,
    "switches": 1,
    "last_check": "2026-02-02T09:11:35.852Z",
    "last_switch": "2026-02-02T02:29:31.902Z"
  }
}
```

### å…³é”®å­—æ®µ
- **`current_ip`**: å½“å‰IPåœ°å€ï¼ˆå¿…éœ€å­—æ®µï¼‰

## ğŸ“Š å·¥ä½œæµç¨‹

### å¯åŠ¨æ—¶IPè·å–
```
1. æ£€æŸ¥æ˜¯å¦é…ç½®äº† DirectIpApiUrl
2. å¦‚æœé…ç½®äº†ï¼š
   â”œâ”€ è°ƒç”¨ç›´æ¥IPæŸ¥è¯¢API
   â”œâ”€ è§£æ current_ip å­—æ®µ
   â”œâ”€ æˆåŠŸ â†’ ä½¿ç”¨è·å–çš„IP
   â””â”€ å¤±è´¥ â†’ å›é€€åˆ°è®¾å¤‡ç»„API
3. å¦‚æœæœªé…ç½®ï¼š
   â””â”€ ä½¿ç”¨è®¾å¤‡ç»„APIï¼ˆåŸæœ‰æ–¹å¼ï¼‰
```

### æ¢å¤æ£€æµ‹æ—¶IPè·å–
```
æ¯60ç§’æ‰§è¡Œï¼š
1. ä¼˜å…ˆä½¿ç”¨ç›´æ¥APIè·å–æœ€æ–°IP
2. å¦‚æœç›´æ¥APIå¤±è´¥ï¼Œå›é€€åˆ°è®¾å¤‡ç»„API
3. æ£€æµ‹IPå˜åŒ–å¹¶é€šçŸ¥
4. æµ‹è¯•æ–°IPè¿é€šæ€§
5. å†³å®šæ˜¯å¦åˆ‡æ¢DNSè®°å½•
```

## ğŸ‰ å®é™…è¿è¡Œæ•ˆæœ

### æˆåŠŸæ—¥å¿—ç¤ºä¾‹
```
dbug: ä½¿ç”¨ç›´æ¥IPæŸ¥è¯¢API: https://nya-getip-iepl1.trp.sh/status
dbug: ç›´æ¥IPæŸ¥è¯¢APIå“åº”: {"current_ip": "14.215.39.86", ...}
info: é€šè¿‡ç›´æ¥APIæˆåŠŸè·å–IPåœ°å€: 14.215.39.86
info: è·å–åˆ°åˆå§‹IPåœ°å€: 14.215.39.86
dbug: TCPè¿æ¥æ­£å¸¸ - 14.215.39.86:23451
```

### å›é€€æ—¥å¿—ç¤ºä¾‹
```
dbug: ä½¿ç”¨ç›´æ¥IPæŸ¥è¯¢API: https://example.com/api/ip
fail: ç›´æ¥IPæŸ¥è¯¢APIè¯·æ±‚å¤±è´¥: NotFound
warn: ç›´æ¥APIè·å–IPå¤±è´¥ï¼Œå›é€€åˆ°è®¾å¤‡ç»„API
dbug: å‘é€ç™»å½•è¯·æ±‚: {"username":"...","password":"..."}
info: æˆåŠŸè·å–è®¤è¯token
info: é€šè¿‡è®¾å¤‡ç»„APIæˆåŠŸè·å–IPåœ°å€: 14.215.39.86
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIåœ°å€æ— æ•ˆ**
   ```
   fail: ç›´æ¥IPæŸ¥è¯¢APIè¯·æ±‚å¤±è´¥: NotFound
   ```
   **è§£å†³**: æ£€æŸ¥ `DirectIpApiUrl` é…ç½®æ˜¯å¦æ­£ç¡®

2. **å“åº”æ ¼å¼é”™è¯¯**
   ```
   fail: ç›´æ¥IPæŸ¥è¯¢APIå“åº”ä¸­æœªåŒ…å«æœ‰æ•ˆIPåœ°å€
   ```
   **è§£å†³**: ç¡®è®¤APIè¿”å›åŒ…å« `current_ip` å­—æ®µ

3. **ç½‘ç»œè¿æ¥é—®é¢˜**
   ```
   fail: è°ƒç”¨ç›´æ¥IPæŸ¥è¯¢APIæ—¶å‘ç”Ÿå¼‚å¸¸: HttpRequestException
   ```
   **è§£å†³**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

### æµ‹è¯•å‘½ä»¤
```bash
# æµ‹è¯•APIå¯ç”¨æ€§
curl https://nya-getip-iepl1.trp.sh/status

# æ£€æŸ¥å“åº”æ ¼å¼
curl -s https://nya-getip-iepl1.trp.sh/status | jq '.current_ip'
```

## ğŸš€ ä¼˜åŠ¿æ€»ç»“

1. **æ€§èƒ½æå‡**: 7.5å€é€Ÿåº¦æå‡
2. **ç®€åŒ–é…ç½®**: æ— éœ€ç”¨æˆ·åå¯†ç è®¤è¯
3. **é«˜å¯ç”¨æ€§**: è‡ªåŠ¨å›é€€æœºåˆ¶
4. **å®æ—¶æ€§**: æ›´å¿«çš„IPå˜åŒ–æ£€æµ‹
5. **å…¼å®¹æ€§**: å®Œå…¨å‘åå…¼å®¹

è¿™ä¸ªæ–°åŠŸèƒ½è®©ä½ çš„DNSç¾éš¾æ¢å¤ç³»ç»Ÿæ›´åŠ é«˜æ•ˆå’Œå¯é ï¼ğŸ‰